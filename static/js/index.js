$(function ($) {
    // http://api.jqueryui.com/autocomplete/
    var q = $('#keyword'),
        max_suggest = 10, //读本地词库时的最大提示数
        cache = {},
        local_default = [
            "Project Babel", "V2EX", "OLIVIDA", "音乐", "电影", "地球", "BFBC2", "iPhone", "iPad", "MacBook Pro", "Linux", "问与答", "iDev", "Google App Engine", "Twitter", "分享发现", "分享创造", "上海", "北京", "广州", "深圳", "Mac OS X", "Kevin Kelly", "数学", "丽江", "杭州", "摄影", "Project Picky", "桂林", "成都", "重庆", "NDS", "PlayStation 3", "Xbox 360", "PSP", "Wii", "Kindle", "东京", "Android", "iMac", "昆明", "贵阳", "酷工作", "天津", "Resident Evil 5", "iCode", "Redis", "剧集", "Steam", "New York", "NoSQL", "硬件", "自言自语", "Adobe", "游戏", "互联网", "C/C++/Obj-C", "Photoshop", "随想", "HTML", "MySQL", "PHP", "Java", "YouTube", "Google", "3G", "美酒与美食", "iAd", "二手交易", "iLife", "iWork", "VPN", "字体排印", "Mac Pro", "UNIQLO", "Levi's", "G-Star", "Converse", "服务器", "武汉", "Ruby on Rails", "NGINX", "Mac mini", "MacBook", "Medal of Honor", "Vimeo", "WordPress", "无印良品", "foursquare", "Python", "Firefox", "Chrome", "Safari", "ACG", "植物", "反馈", "Opera", "StarCraft 2", "分享邀请码", "OpenStack", "动物", "git", "Blogger", "云计算", "bzr", "Baby", "糗事分享", "宽带症候群", "搜索引擎技术研究", "OAuth", "阅读", "翻译", "香港", "澳门", "湾区", "Wikipedia", "Berlin", "文学", "五子棋", "Digg", "囧", "创造者", "Perl", "Scala", "经济", "教育", "io", "Apache", "CouchDB", "桌游", "iMarketing", "街机游戏", "晒晒更健康", "中文", "HTTP", "Toruk", "正则表达式", "台北", "CSS", "New Balance", "Nike", "Adidas", "宅", "Dell", "Livid", "JavaScript", "Lua", "无要点", "树洞", "滕州", "厦门", "呼和浩特", "BlackBerry", "南京", "西安", "大庆", "强迫症", "80 天环游地球", "沉默的螺旋", "Diesel", "像素", "Hadoop", "MapReduce", "三亚", "海口", "珠海", "cocos2d", "iPod", "Apple TV", "Matrix", "投资", "iGame", "配件", "Erlang", "大连", "汽车", "直升机", "Linkin Park", "贵阳一中", "云南师大附中", "旅行", "OpenSolaris", "MoinMoin", "Apple", "Blu-ray", "汇编", "梦", "Inception", "SSH", "外包", "BMW", "Camino", "MobileMe", "Pink Floyd", "U2", "Nirvana", "Rammstein", "Flash", "DNS", "London", "Cray", "行程控", "无锡", "Xen", "信用卡", "郑州", "Riak", "Linode", "福州", "济南", "兰州", "青岛", "苏州", "扬州", "设计", "京都", "硅谷", "Podcast", "Lacrimosa", "Ideology", "TechCrunch", "Quora", "REWORK", "Inbox", "Audi", "AutoCAD", "Diablo III", "日本語", "English", "风水", "Iconfactory", "Nokia", "他他", "她她", "24 小时", "绿色低碳", "Seattle", "GQ", "Sydney", "长沙", "生活方式", "Paris", "Dubai", "Singapore", "Mozilla", "Call of Duty", "STOP", "武汉大学", "vim", "Lamy", "Moleskine", "北京大学", "清华大学", "Emacs", "上海交通大学", "中山大学", "画画", "Final Cut Pro", "Motion", "网络安全", "村上春树", "The Beatles", "熵", "亚丁湾", "指环王", "2012", "汇丰银行", "丰田", "webOS", "渣打银行", "花旗银行", "荷兰银行", "德意志银行", "瑞士银行", "Lisp", "WIRED", "能源", "Condé Nast", "Samsonite", "Dior", "OMEGA", "Need for Speed", "EF", "Textie", "物物交换", "天黑以后", "Dropbox", "自行车", "宜家", "Alienware", "Facebook", "SQLite", "团购", "SONY", "Oslo", "Stockholm", "Portland", "Game Dev Story", "Amazon Web Services", "程序员", "设计师", "变形金刚", "Cartier", "Davidoff", "Gap", "日记", "API", "非诚勿扰", "天使投资", "商业模式", "MongoDB", "新手求助", "TED", "水深火热", "标准", "饭否 API", "Volkswagen", "科幻", "乐活", "不靠谱茶话会", "528491", "小小大星球", "3DS", "Battlefield 3", "cURL", "MacBook Air", "Origin", "Asana", "asdf", "1Q84", "AdSense", "AdWords", "最终幻想", "Cut the Rope", "H&M", "Killzone", "站长", "黑魔法", "Yippee Arts", "Minecraft", "MUSE", "莱卡", "佳能", "尼康", "Bento", "Instapaper", "Dribbble", "EC", ".NET", "本体论", "Zakka", "L'Oréal", "Alexa", "GarageBand", "3ds Max", "LANCÔME", "日本", "寻人", "AdMob", "Windows", "Tornado", "Path", "Guild Wars 2", "Chamber", "PostgreSQL", "使用指南", "Ruby", "早睡早起身体好俱乐部", "Portal series", "罗技", "Amazon", "Fusion-io", "Blog", "iRobot", "Go", "Starbucks", "仙剑奇侠传", "World of Warcraft", "Creative Commons", "水", "新余", "岳阳", "大理", "长春", "遵义", "西宁", "哈尔滨", "南昌", "保定", "Crysis", "Windows Phone", "Arch", "铜仁", "Getting Things Done", "开源软件", "GCC", "LLVM", "AMD", "Intel", "NVIDIA", "Maya", "Shade", "Bitcoin", "Porsche", "Project Stormwind", "reddit", "Oracle", "Bing", "Pixelmator", "Jekyll", "Y Combinator", "Arc", "编程", "操作系统", "版本控制系统", "编程框架", "软件", "计算机", "游戏主机", "BASIC", "数据库", "浏览器", "Mercurial", "Cobra", "jQuery", "WWDC", "PlayStation Vita", "EA", "Nintendo", "iCloud", "Django", "中二病", "1990", "Celery", "Instagram", "node.js", "DotCloud", "Google Wave Protocol", "ifttt", "媒体", "LUMIX", "GoPro", "iTunes", "App Store", "科技", "RAGE", "Chicago", "OpenGL", "DirectX", "DUST 514", "Gnome", "DotA", "CDN", "英雄联盟", "Scrum", "CentOS", "游戏开发", "Unreal Development Kit", "VMware", "GlassFish", "Jinja", "Monocle", "UNITY", "Blender", "3D", "Project Zeppelin", "Flask", "I Am A", "Razer", "NetBeans", "跑步", "Clojure", "ColdFusion", "WhatsApp", "Backbone.js", "TextMate", "编辑器", "吉林大学", "500px", "Pinterest", "Sina App Engine", "Subversion", "海外留学", "空气", "LEGO", "Project Asteroid", "公司运营", "支付宝", "Xcode", "上古卷轴 V", "Metal Gear Solid", "Homebrew", "RabbitMQ", "业界八卦", "Grand Theft Auto", "星球大战", "InDesign", "Illustrator", "分享萌物", "Fling", "Pogo", "FreeBSD", "视频制作", "Trello", "Lighttpd", "Arduino", "求职", "Gran Turismo", "宠物", "Charles", "EVE", "Wacom", "Markdown", "Zope", "iBook", "微博", "Project Galaxy", "Project Museum", "奇思妙想", "中国科学技术大学", "关闭交易", "骑行", "0x10c", "蘑菇", "Paper", "Homme", "域名", "Femme", "TechStars", "Meteor", "Haskell", "SQLAlchemy", "Storm", "绿茵场", "Sublime Text", "Ubuntu", "Fedora", "Gentoo", "Los Angeles", "Evernote", "唐茶", "沙盒", "Down Voted", "信息处理中心", "吉他", "时间", "签证", "Dev", "Lightroom", "Aperture", "免费赠送", "Stripe", "咖啡", "G-WAN", "Squid", "Velocity", "生活", "欧洲", "英国", "美国", "瑞典", "德国", "OpenBSD", "HAProxy", "MECE", "C3Edge", "Snort", "SSL", "RRDtool", "XenServer", "Puppet", "Doit.im", "CloudStack", "SimCity", "Varnish", "RQ", "KDE", "Hawken", "调查", "iOS", "Windows Azure", "IIS", "New Relic", "Startup Visa", "make", "O'Reilly", "Delphi", "宁波", "4G", "MemSQL", "OpenVZ", "NBA", "EdgeCast", "Fitbit", "Couchbase", "Cassandra", "HBase", "Lucene", "ERP", "Cisco", "Solr", "硅谷", "OpenShift", "新单位", "ORCA", "魅族", "不是问题的问题", "Computer vision", "Pasadena", "奥运会", "Stack Overflow", "Nexus", "每个月都会出现的那种主题", "App.net", "elasticsearch", "Santa Monica", "Phusion Passenger", "Anno", "Chocolat", "San Francisco", "Big Data", "DevOps", "VirtualBox", "Cherokee", "Ubersmith", "Chef", "Battle for Wesnoth", "IRC", "Munin", "Solaris", "Heroku", "Ingress", "Las Vegas", "NetBSD", "OpenNebula", "Juniper", "Ceph", "Swift", "Splunk", "stunnel", "California", "SmartOS", "ZFS", "Atlassian", "SDN", "Unix", "Clash of Clans", "shadowsocks", "微信", "Raspberry Pi", "Square", "openSUSE", "VPS", "LXC", "Confluence", "Wiki", "Plone", "Sphinx", "reStructuredText", "HUBOT", "Vagrant", "Ansible", "Traffic Server", "加拿大", "中国", "墨西哥", "韩国", "亚洲", "Discourse", "Fluentd", "Debian", "Alfred", "Resident Evil 6", "Cloudera", "PlayStation 4", "我叫 MT", "Eucalyptus", "机器学习", "台湾", "PayPal", "OpenResty", "Stash", "XeHost", "VoltDB", "ELINKVPS", "Battlefield 4", "Smartisan OS", "SSD", "AeroFS", "MIUI", "前端优化", "Sailfish", "机械键盘", "LINE", "Spark", "Google Glass", "发烧友", "EMC", "微软", "健康", "WebRTC", "Braun", "SOHO", "4K", "重口味问与答", "German", "Duolingo", "Core", "LVM", "JIRA", "Bash", "Oculus VR", "BTSync", "iTransfer", "MapR", "Docker", "Hyperloop", "Bootstrap", "ZooKeeper", "IE", "PowerDNS", "Dyn", "Salt Stack", "SAP", "纪录片", "淘宝", "Dogma", "Diamond Bar", "Rowland Heights", "Walnut", "Borderlands", "Ghost", "来往", "Nissan", "Chevrolet", "海外运营", "Hearthstone", "Heroes of the Storm", "项目管理", "剑灵", "FoundationDB", "Dart", "Xbox One", "Herman Miller", "Ripple", "BOINC", "优惠信息", "Wii U", "Linux Mint", "外汇交易", "魔兽争霸", "MODO", "Lynda", "Mudbox", "情感问题", "Titanfall", "Percona", "KVM", "Sentry", "Rust", "Serf", "Boston", "CoreOS", "体育运动", "OUYA", "OpenCL", "WebP", "Wagas", "MBTI", "职场话题", "iBeacon", "GitHub", "Atom", "Bose", "Sputnik", "PowerShell", "搜索引擎优化", "Ace", "SolarCity", "SpaceX", "Hack", "Avocado", "Sketch", "RFC", "Medium", "Samsung", "Tarsnap", "沈阳", "SSDB", "Rust", "前端开发", "Servo", "Phabricator", "bong", "AVOS Cloud", "ThinkPad", "太阳能", "日志处理", "雅思", "工作假期签证", "Syslog", "Uber", "Twitch", "买买买", "Notes", "OpenWrt", "福特", "奔驰", "Battlefield Hardline", "模拟驾驶", "OneAPM", "草稿箱", "抑郁症", "AngularJS", "Tesla", "Destiny", "Waze", "Factorio", " WATCH", "Corvette"    
        ],
        cache = {}

    var filter = function (array, searching_str) {
        return $.grep(array, function (value) {
            //关键字满足开头才返回,忽略大小写
            return 0 === value.toLowerCase().indexOf(searching_str.toLowerCase())
        }).slice(0, max_suggest)
    }

    q.autocomplete({
        source: function (rq, rsp) {
            var term = rq.term
            if (term in cache) {
                rsp(cache[term])
            }
            else {
                $.getJSON('http://107.155.97.232/suggest', rq)
                    //远程获取
                    .done(function (data) {
                        console.info('done')
                        if(data['data']){
                            cache[term] = data['data'] //缓存每次远程结果
                            rsp(data['data'])
                        }   
                    })  

                    //远程失败则从本地获取
                    .fail(function (jq) {
                        console.info('fail')
                        rsp(filter(local_default, term))
                    })
            }
        }
    })
})
